<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email PIC Chairs</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <header>
        <img src="../images/header.jpeg" alt="Banner">
    </header>
    <main>
        <h1>Email Pension Investment Committee Chairs</h1>
        <div class="explanation">
            <p>Use this tool to email the chairs of the Pension Investment Committees across the PEPPA boroughs.
            Simply enter your name and click submit to generate an email to all PIC chairs.</p>
        </div>
        <form id="custom-form">
            <input type="text" id="fullName" placeholder="Enter your full name" required>
            <button type="submit">Generate Email</button>
        </form>
    </main>

    <!-- Modal structure -->
    <div id="resultModal">
        <div id="modalContent">
            <div id="loading" style="display: none;">
                <div class="spinner"></div>
                <div>Loading, please wait...</div>
            </div>
            <div id="result"></div>
            <button id="closeModal">Close</button>
        </div>
    </div>

    <script type="text/javascript">
        // PIC Chairs data
        const picChairs = [
            { name: 'Sian Eiles', email: 'sian.eiles@lewisham.gov.uk', borough: 'Lewisham' },
            { name: 'Johar Khan', email: 'cllr.johar.khan@walthamforest.gov.uk', borough: 'Waltham Forest' },
            { name: 'Mandy Anderson', email: 'Councillormandy.anderson@havering.gov.uk', borough: 'Havering' },
            { name: 'Cryss Mennaceur', email: 'cryss.mennaceur@sutton.gov.uk', borough: 'Sutton' },
            { name: 'Rishikesh Chakraborty', email: 'cllr.R.Chakraborty@barnet.gov.uk', borough: 'Barnet' }
        ];

        // Email template from body.docx
        const emailTemplate = `Dear Sir/Madam,

I hope this finds you well. I write in regard to our borough's pension scheme investments in the 'Passive Equity Progressive Paris-Aligned' (PEPPA) fund - managed by the London CIV (LCIV).

I understand that on 4th November you will be meeting with the other pension committee chairs of the five boroughs invested in PEPPA, and a representative from LCIV, to discuss the issue of divesting from PEPPA's investments in companies complicit in genocide, apartheid, and human rights abuses.

I urge you to use this meeting to agree to an exclusions framework for these complicit companies, to be applied to PEPPA. I am aware that a suitable exclusions framework, prepared with the support of pensions lawyers, has already been shared with you by the Lewisham divestment campaign.

I remind you that, through PEPPA, pension holders' money is invested in, amongst others, a company providing AI targeting systems to Israel's military, actively facilitating genocide. And despite longstanding judgements on the illegality of Israel's settlements under international law, pension holders' money is still invested in Israeli banks actively funding the expansion of illegal settlements. Furthermore, our borough invests in companies that have been repeatedly identified and repeatedly called on by the UN Human Rights Office to "take appropriate action to address the adverse human rights impacts" of their activities in Palestine. It is beyond the comprehension of many residents and pension holders that anyone would invest someone else's money - on their behalf but against their will - in companies facilitating some of the world's worst human rights abuses. Investments that - by contravening international law - may themselves be risky.

I understand the challenges of 'passive funds' and that 'things move slowly in pensions', but after two years of Israel's genocide, it beggars belief that our boroughs have not removed pension holders' money from these companies or even set out a clear plan for doing so.

I am asking you to do everything in your power to agree on an exclusions framework in the meeting on 4th November. And whilst this would be a positive interim step, I'd also ask you to use your influence to press LCIV for complete divestment across London's pension schemes in the longer term.

With local elections around the corner next year, I want to rest assured that our borough can demonstrate the moral leadership this situation requires. 

Yours sincerely,
{signee}`;

        function generateEmail(fullName) {
            const emailBody = emailTemplate.replace('{signee}', fullName);
            const encodedBody = encodeURIComponent(emailBody);
            const subject = encodeURIComponent('PEPPA Divestment - 4th November Meeting');

            // Generate comma-separated list of all recipients
            const recipients = picChairs.map(chair => chair.email).join(',');

            return `mailto:${recipients}?bcc=info@lewishampsc.org&subject=${subject}&body=${encodedBody}`;
        }

        function escapeHtml(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        jQuery(document).ready(function($) {
            $('#custom-form').on('submit', function(event) {
                event.preventDefault();

                const fullName = $('#fullName').val().trim();
                const mailtoUrl = generateEmail(fullName);
                const emailBody = emailTemplate.replace('{signee}', fullName);

                let html = '<h2>Email Generated Successfully</h2>';
                html += '<p>Click the button below to open your email client with a pre-filled message to all PIC chairs:</p>';
                html += '<div class="councillor-links">';
                html += `<a class="councillor-link" target="_blank" href="${mailtoUrl}">Open Email to All PIC Chairs</a>`;
                html += '</div>';

                html += '<h3>Recipients:</h3>';
                html += '<ul style="list-style-type: none;">';
                picChairs.forEach(chair => {
                    html += `<li><strong>${chair.name}</strong> - ${chair.borough}</li>`;
                });
                html += '</ul>';

                // Fallback section
                html += `<div class="fallback-section">
                    <h2>Email not opening correctly?</h2>
                    <p>If the button above doesn't work, you can manually copy the email content:</p>
                    <button class="copy-email-btn" id="copyEmailBtn" data-email="${escapeHtml(emailBody)}">
                        Copy Email Text
                    </button>
                    <p style="margin-top: 10px;">Then manually create an email to: ${picChairs.map(c => c.email).join(', ')}</p>
                    <p>Subject: PEPPA Divestment - 4th November Meeting</p>
                </div>`;

                $('#result').html(html);
                $('#resultModal').css('display', 'flex');
            });

            // Copy email to clipboard functionality
            $(document).on('click', '.copy-email-btn', function() {
                const emailText = $(this).data('email');

                navigator.clipboard.writeText(emailText)
                    .then(() => {
                        const $btn = $(this);
                        const originalText = $btn.text();
                        $btn.text('Copied! âœ“');
                        setTimeout(() => $btn.text(originalText), 2000);
                    })
                    .catch(err => {
                        alert('Could not copy email text: ' + err);
                    });
            });

            // Close modal button
            $('#closeModal').on('click', function() {
                $('#resultModal').css('display', 'none');
            });
        });
    </script>
</body>
</html>
